var yafowil_datetime=function(e,t,i){"use strict";class s extends Datepicker{static initialize(e){t("input.datepicker",e).each((function(){let e=t(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(e)||new s(e,e.data("date-locale"))}))}constructor(e,i,r={}){let o={language:i,orientation:"bottom",buttonClass:"btn",todayHighlight:!0,autohide:!0};e.offset().top+e.outerHeight()+250>t(document).height()&&(o.orientation="top");let a=s.locale_options;Object.assign(o,a[i]||a.en),Object.assign(o,r),super(e[0],o),e.data("yafowil-datepicker",this),this.elem=e,this.adapt(),this.trigger=t("<button />").addClass("datepicker-trigger btn btn-outline-secondary").text("...").insertAfter(e),this.toggle_picker=this.toggle_picker.bind(this),this.trigger.on("mousedown touchstart",this.toggle_picker),this.trigger.on("click",(e=>{e.preventDefault()})),this.on_change_date=this.on_change_date.bind(this),this.elem.on("changeDate",this.on_change_date),void 0!==window.ts&&ts.ajax.attach(this,e);let l=t.Event("datepicker_created",{widget:this});this.elem.trigger(l)}on_change_date(){this.elem.trigger("change")}adapt(){const e=t(this.picker.element);t(".datepicker-picker",e).addClass("card");const i=t(".datepicker-header",e).addClass("card-header bg-primary");t(".btn",i).addClass("btn-primary"),t(".datepicker-main",e).addClass("card-body")}unload(){void 0!==window.ts&&ts.deprecate("yafowil.widget.datepicker.unload","yafowil.widget.datepicker.destroy","yafowil 2.1"),this.destroy()}toggle_picker(e){e.preventDefault(),e.stopPropagation(),this.picker.active||this.active?(this.hide(),this.elem.blur()):this.show()}destroy(){this.trigger.off("mousedown touchstart",this.toggle_picker),this.trigger.off(),this.elem.off("changeDate",this.on_change_date),super.destroy(),this.elem.off().removeData().remove()}}function r(e,t){s.initialize(t)}function o(){void 0!==window.yafowil_array&&window.yafowil_array.on_array_event("on_add",r)}s.locale_options={en:{weekStart:1,format:"mm.dd.yyyy"},de:{weekStart:1,format:"dd.mm.yyyy"}};class a{constructor(e,t){this.elem=e,this.parent=t}get selected(){return this.elem.hasClass("selected")}set selected(e){e?(this.parent.remove_previously_selected(),this.elem.addClass("selected")):this.elem.removeClass("selected")}get previously_selected(){return this.elem.hasClass("prev-selected")}set previously_selected(e){e?this.elem.addClass("prev-selected"):this.elem.removeClass("prev-selected")}}class l{constructor(e,t){this.picker=e,this.elem=t,this.children=[]}unload_all(){for(let e of this.children)e.elem.off("click",e.on_click)}unselect_all(){for(let e of this.children)e.selected=!1}mark_previously_selected(){for(let e of this.children)e.selected&&(e.previously_selected=!0,e.selected=!1)}remove_previously_selected(){for(let e of this.children)e.previously_selected=!1}}class n extends a{constructor(e,i,s,r){super(t("<div />").addClass("cell").text(new String(s).padStart(2,"0")).appendTo(i),e),this.hours=e,this.picker=e.picker,this.period=r,this.on_click=this.on_click.bind(this),this.elem.on("click",this.on_click)}on_click(e){let t=this.elem.text();this.hours.unselect_all(),this.selected=!0,this.picker.period=this.period,this.picker.hour=t}}class d extends a{constructor(e,i,s){super(t("<div />").addClass("cell").text(new String(s).padStart(2,"0")).appendTo(i),e),this.minutes=e,this.picker=e.picker,this.on_click=this.on_click.bind(this),this.elem.on("click",this.on_click)}on_click(e){this.minutes.unselect_all(),this.selected=!0,this.picker.minute=this.elem.text()}}class h extends l{constructor(e,i){super(e,t("<div />").addClass("card-body hours-content")),24===e.clock?this.create_clock_24():12===e.clock&&this.create_clock_12(),this.to_minute=this.to_minute.bind(this);let s=t("<div />").addClass("header card-header bg-primary text-white").text(e.translate("hour"));this.minutes_btn=t("<button />").append(t('<i class="bi bi-caret-right"/>')).append(t("<span>Minute</span>")).addClass("to_minutes d-block d-sm-none btn p-0 float-end").on("click",this.to_minute).appendTo(s),this.container_elem=t("<div />").addClass("card timepicker-hours").append(s).append(this.elem).appendTo(i)}create_clock_24(){for(let e=0;e<24;e++)this.children.push(new n(this,this.elem,e))}create_clock_12(){t("<span />").addClass("am").text("A.M.").appendTo(this.elem);let e=t("<div />").addClass("am").appendTo(this.elem);t("<span />").addClass("pm").text("P.M.").appendTo(this.elem);let i=t("<div />").addClass("pm").appendTo(this.elem);for(let t=0;t<12;t++)this.children.push(new n(this,e,t,"AM"));for(let e=0;e<12;e++)this.children.push(new n(this,i,e,"PM"));this.elem.css("grid-template-rows","1fr 1fr"),this.elem.css("grid-template-columns","auto 1fr")}to_minute(e){e.preventDefault(),this.container_elem.hide(),this.picker.minutes.container_elem.show()}}class c extends l{constructor(e,i,s){super(e,t("<div />").addClass("card-body minutes-content")),this.step=s;let r=60/s,o=0;if(r<=32){o=Math.ceil(r/4);let e="1fr ".repeat(Math.ceil(r/4));this.elem.css("grid-template-columns",e)}else o=10,this.elem.css("grid-template-columns","1fr ".repeat(10)),24===e.clock?t("div.hours-content",e.dd_elem).css({"grid-template-columns":"1fr 1fr 1fr 1fr"}):t("div.am, div.pm",e.dd_elem).css({"grid-template-columns":"1fr 1fr 1fr 1fr"});this.columns_count=o;for(let e=0;e<r;e++)this.children.push(new d(this,this.elem,e*s));this.to_hour=this.to_hour.bind(this);let a=t("<div />").addClass("header card-header bg-primary text-white").text(e.translate("minute"));this.hours_btn=t("<button />").append(t('<i class="bi bi-caret-left"/>')).append(t("<span>Hour</span>")).addClass("to_hours d-block d-sm-none btn p-0 float-end").on("click",this.to_hour).appendTo(a),this.container_elem=t("<div />").addClass("card timepicker-minutes").append(a).append(this.elem).appendTo(i)}to_hour(e){e.preventDefault(),this.container_elem.hide(),this.picker.hours.container_elem.show()}}class p{static initialize(e){t("input.timepicker",e).each((function(){let e=t(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(e)||(e.attr("spellcheck",!1),new p(e,{language:e.data("time-locale"),clock:e.data("time-clock"),step:e.data("time-minutes_step")}))}))}constructor(e,s){e.data("yafowil-timepicker",this),this.elem=e,this.language=s.language||"en",this.clock=s.clock||24,this.period=null,this.hour="",this.minute="",s.step<=0||s.step>60||"number"!=typeof s.step?this.step=5:this.step=s.step,this.trigger_elem=t("<button />").addClass("timepicker-trigger btn btn-outline-secondary").text("...").insertAfter(e);let r=this.dd_elem=t("<div />").addClass("timepicker-dropdown").insertAfter(e.closest(".input-group")),o=t("<div />").addClass("timepicker-container card-group shadow").appendTo(r);this.hours=new h(this,o),this.minutes=new c(this,o,this.step),this.calc_flex_basis(this.minutes.columns_count),this.validate(),this.show_dropdown=this.show_dropdown.bind(this),this.elem.on("focus",this.show_dropdown),this.toggle_dropdown=this.toggle_dropdown.bind(this),this.trigger_elem.on("click",this.toggle_dropdown),this.hide_dropdown=this.hide_dropdown.bind(this),t(document).on("click",this.hide_dropdown),this.on_keypress=this.on_keypress.bind(this),this.elem.on("keypress",this.on_keypress),this.validate=this.validate.bind(this),this.elem.on("keyup",this.validate),this.popper=i.createPopper(this.elem[0],this.dd_elem[0],{placement:"bottom-start",modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:10}},{name:"flip",options:{allowedAutoPlacements:["top-start","bottom-start"],rootBoundary:"viewport"}}]});let a=t.Event("timepicker_created",{widget:this});this.elem.trigger(a),void 0!==window.ts&&window.ts.ajax.attach(this,e)}calc_flex_basis(e){let t=6;60/this.step>32&&(t=24===this.clock?4:5),e<2&&(e=2);const i=t+e,s=t/i*100,r=e/i*100;this.hours.container_elem.css("flex-basis",s.toFixed(2)+"%"),this.minutes.container_elem.css("flex-basis",r.toFixed(2)+"%");const o=`calc(${40*i}px + 4rem)`;this.dd_elem.css("width",o)}unload(){void 0!==window.ts&&ts.deprecate("yafowil.widget.timepicker.unload","yafowil.widget.timepicker.destroy","yafowil 2.1"),this.destroy()}get hour(){return this._hour}set hour(e){this._hour=e,this.set_time()}get minute(){return this._minute}set minute(e){this._minute=e,this.set_time()}set_time(){""!==this.hour&&""!==this.minute&&(24===this.clock?this.elem.val(`${this.hour}:${this.minute}`):12===this.clock&&this.elem.val(`${this.hour}:${this.minute}${this.period}`),this.elem.trigger("change"),this.hour="",this.minute="",this.hours.mark_previously_selected(),this.minutes.mark_previously_selected(),t(window).width()<=575&&this.reset_visibility(),this.dd_elem.hide())}reset_visibility(){this.hours.container_elem.show(),this.minutes.container_elem.hide()}hide_dropdown(e){e.target!==this.elem[0]&&e.target!==this.trigger_elem[0]&&0===t(e.target).closest(this.dd_elem).length&&(this.dd_elem.hide(),""!==this.hour&&""!==this.minute||(this._hour="",this._minute=""),this.hours.unselect_all(),this.minutes.unselect_all())}show_dropdown(e){this.dd_elem.show(),this.popper.forceUpdate()}toggle_dropdown(e){e.preventDefault(),this.dd_elem.toggle(),this.popper.forceUpdate()}on_keypress(e){e.preventDefault();let t=this.elem.val(),i=e.target.selectionStart;if("Enter"===e.key&&(this.dd_elem.hide(),this.elem.blur()),i<=4)e.key.match(new RegExp("[0-9]"))&&(this.elem.val(t+e.key),2===i&&this.elem.val(`${t}:${e.key}`));else if(5===i&&12===this.clock){["a","A","p","P"].includes(e.key)&&this.elem.val(t+e.key)}else 6===i&&12===this.clock&&("m"!==e.key&&"M"!==e.key||this.elem.val(t+e.key))}validate(){if(!this.elem.val())return;let e=this.elem.val(),t=new RegExp(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/),i=new RegExp(/^(?:0?\d|1[012]):[0-5]\d[apAP][mM]$/),s=e.substr(0,2),r=parseInt(s),o=e.substr(3,2),a=parseInt(o)/this.step;if(24===this.clock){if(!e.match(t)||e.length<5)return}else if(12===this.clock){if(!e.match(i)||e.length<7)return;let t=e.substr(5).toUpperCase();this.period="PM"===t?"PM":"AM","PM"===t&&(r+=12)}this.hours.children[r].on_click();let l=this.minutes.children[a];l?l.on_click():this.minutes.unselect_all()}translate(e){let t=this.constructor.locales;return(t[this.language]||t.en)[e]}destroy(){t(document).off("click",this.hide_dropdown),this.popper.destroy(),this.hours.unload_all(),this.minutes.unload_all(),this.dd_elem.remove()}}function m(e,t){p.initialize(t)}function u(){void 0!==window.yafowil_array&&window.yafowil_array.on_array_event("on_add",m)}return p.locales={en:{hour:"Hour",minute:"Minute"},de:{hour:"Stunde",minute:"Minute"}},t((function(){void 0!==window.ts?(ts.ajax.register(s.initialize,!0),ts.ajax.register(p.initialize,!0)):void 0!==window.bdajax?(bdajax.register(s.initialize,!0),bdajax.register(p.initialize,!0)):(s.initialize(),p.initialize()),o(),u()})),e.DatepickerWidget=s,e.TimepickerButton=a,e.TimepickerButtonContainer=l,e.TimepickerHour=n,e.TimepickerHours=h,e.TimepickerMinute=d,e.TimepickerMinutes=c,e.TimepickerWidget=p,e.register_datepicker_array_subscribers=o,e.register_timepicker_array_subscribers=u,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.datetime=e,e}({},jQuery,Popper);
